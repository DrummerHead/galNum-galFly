var $ = require('selector');

var galUi = (function(){
  return {
    defaultShift: 25,
    currentImage: 0,
    minImage: 0,
    maxImage: this.defaultShift,

    init: function(galWidthElement){
      var _this = this;
      onkeypress = function(e){
        switch(e.charCode){
          case 105:
            _this.seek(false);
          break;
          case 106:
            _this.goToImage(true);
          break;
          case 107:
            _this.goToImage(false);
          break;
          case 108:
            _this.zoom();
          break;
          case 111:
            _this.seek(true);
          break;
          case 117:
            _this.resumeWebm(_this.currentImage);
        }
      };
      $('#down').addEventListener('click', function(){
        _this.goToImage(true);
      });
      $('#up').addEventListener('click', function(){
        _this.goToImage(false);
      });
      $('#zoom').addEventListener('click', function(){
        _this.zoom($('#a' + _this.currentImage));
      });
      $('#light').addEventListener('click', function(){
        this.count = this.count ? (this.count + 1) % 3 : 1;
        switch(this.count){
          case 0:
            var color = "#808080";
          break;
          case 1:
            var color = "#000";
          break;
          case 2:
            var color = "#fff";
        }
        document.body.style.backgroundColor = color;
      });
    },

    goToImage: function(isGoingDown){
      if(isGoingDown){
        if((this.currentImage + 1) >= this.maxImage){
          scrollTo(0, document.body.scrollHeight);
          this.resumeWebm(this.currentImage, false);
        }
        else{
          this.resumeWebm(this.currentImage, false);
          scrollTo(0, $('#a' + ++this.currentImage).offsetTop - 5);
          this.resumeWebm(this.currentImage, true);
        }
      }
      else{
        if((this.currentImage - 1) >= this.minImage){
          this.resumeWebm(this.currentImage, false);
          scrollTo(0, $('#a' + --this.currentImage).offsetTop - 5);
          this.resumeWebm(this.currentImage, true);
        }
      }
    },

    fullScreen: function(el){
      if (el.requestFullscreen) {
        el.requestFullscreen();
      } else if (el.mozRequestFullScreen) {
        el.mozRequestFullScreen();
      } else if (el.webkitRequestFullscreen) {
        el.webkitRequestFullscreen();
      }
      el.fs = true;
    },

    exitFullscreen: function(el){
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
      el.fs = false;
    },

    zoom: function(el){
      var el = $('#a' + this.currentImage);
      if(el.nodeName === 'VIDEO'){
        if(el.fs){
          this.exitFullscreen(el);
        }
        else {
          this.fullScreen(el);
        }
      } else if (el.nodeName === 'IMG') {
        el.parentNode.classList.toggle('zoom');
      }
    },

    resumeWebm: function(id, willPlay){
      var element = $('#a' + id);
      var willPlay = willPlay === undefined ? element.paused : willPlay;
      if(element.nodeName === 'VIDEO'){
        if(willPlay){
          element.play();
        }
        else {
          element.pause();
          if(element.fs){
            this.exitFullscreen(element);
          }
        }
      }
    },

    seek: function(isForward){
      var seekAmount = isForward ? 5 : -5;
      var el = $('#a' + this.currentImage);
      el.currentTime = ((el.currentTime + seekAmount) % el.duration)
    }
  }
})();

module.exports = galUi;
